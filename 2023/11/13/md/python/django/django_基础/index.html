<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>吕小布の博客 | 吕小布の博客</title><meta name="keywords" content="吕小布;博客;生活记录"><meta name="author" content="Sai"><meta name="copyright" content="Sai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[TOC] 1.web应用程序1.1.实现简单的web应用程序server.py 123456789101112131415import socketsock &#x3D; socket.socket()sock.bind((&amp;#x27;127.0.0.1&amp;#x27;,9090))sock.listen(5)while 1:    print(&amp;#x27;server waiting...&amp;#x27;)">
<meta property="og:type" content="article">
<meta property="og:title" content="吕小布の博客">
<meta property="og:url" content="https://mindcons.cn/2023/11/13/md/python/django/django_%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="吕小布の博客">
<meta property="og:description" content="[TOC] 1.web应用程序1.1.实现简单的web应用程序server.py 123456789101112131415import socketsock &#x3D; socket.socket()sock.bind((&amp;#x27;127.0.0.1&amp;#x27;,9090))sock.listen(5)while 1:    print(&amp;#x27;server waiting...&amp;#x27;)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2023-11-12T23:54:27.782Z">
<meta property="article:modified_time" content="2023-12-05T23:38:18.386Z">
<meta property="article:author" content="Sai">
<meta property="article:tag" content="吕小布;博客;生活记录">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mindcons.cn/2023/11/13/md/python/django/django_%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"61301LMFP2","apiKey":"a7627d15f4af23df7fbc3e2922471858","indexName":"mindcons","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":350},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Sai","link":"链接: ","source":"来源: 吕小布の博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '吕小布の博客',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-06 07:38:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/custom/css/custom.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://bu.dusays.com/2023/02/10/63e583843360e.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">178</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa-sharp fa-solid fa-photo-film"></i><span> 相册</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/booklist/"><i class="fa-fw fa-solid fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/sponsorWall/"><i class="fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">吕小布の博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa-sharp fa-solid fa-photo-film"></i><span> 相册</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> 番剧</span></a></li><li><a class="site-page child" href="/booklist/"><i class="fa-fw fa-solid fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/sponsorWall/"><i class="fa-fw fas fa-money-check-alt"></i><span> 赞助墙</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-12T23:54:27.782Z" title="发表于 2023-11-13 07:54:27">2023-11-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-05T23:38:18.386Z" title="更新于 2023-12-06 07:38:18">2023-12-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[TOC]</p>
<h1 id="1-web应用程序"><a href="#1-web应用程序" class="headerlink" title="1.web应用程序"></a>1.web应用程序</h1><h2 id="1-1-实现简单的web应用程序"><a href="#1-1-实现简单的web应用程序" class="headerlink" title="1.1.实现简单的web应用程序"></a>1.1.实现简单的web应用程序</h2><p>server.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket()</span><br><span class="line">sock.bind((&#x27;127.0.0.1&#x27;,9090))</span><br><span class="line">sock.listen(5)</span><br><span class="line"></span><br><span class="line">while 1:</span><br><span class="line">    print(&#x27;server waiting...&#x27;)</span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line">    data = conn.recv(1024)</span><br><span class="line">    print(&#x27;data:&#x27;,data)</span><br><span class="line">    # 响应首行和响应体之间，用\r\n\r\n隔开</span><br><span class="line">    conn.send(b&#x27;HTTP/1.1 200 OK\r\n\r\nHello World&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行之后，在浏览器访问<code>127.0.0.1:9009</code>，可以到输出的<code>Hello World</code></p>
<p>后台<code>print</code>如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server waiting...</span><br><span class="line">data: b&#x27;GET /favicon.ico HTTP/1.1\r\nHost: 127.0.0.1:9090\r\nConnection: keep-alive\r\nPragma: no-cache\r\nCache-Control: no-cache\r\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3877.400 QQBrowser/10.8.4506.400\r\nAccept: image/webp,image/apng,image/*,*/*;q=0.8\r\nReferer: http://127.0.0.1:9090/\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: zh-CN,zh;q=0.9\r\n\r\n&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>咱们把<code>\r\n</code>用换行替代一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server waiting...</span><br><span class="line">data: b&#x27;GET /favicon.ico HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:9090</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3877.400 QQBrowser/10.8.4506.400</span><br><span class="line">Accept: image/webp,image/apng,image/*,*/*;q=0.8</span><br><span class="line">Referer: http://127.0.0.1:9090/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>这就是一个简单的web应用程序了</p>
<p>注意，如果不加响应首行，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.send(b&#x27;HelloWorld&#x27;)</span><br></pre></td></tr></table></figure>

<p>则会报以下错误，表示浏览器已经拿到响应了，但是我解析不了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERR_INVALID_HTTP_RESPONSE</span><br></pre></td></tr></table></figure>

<p>因为浏览器拿到服务器传过来的二进制数据，无法解析，需要加上Http响应首行，按照Http协议进行解析</p>
<h2 id="1-2-对比TCP连接"><a href="#1-2-对比TCP连接" class="headerlink" title="1.2.对比TCP连接"></a>1.2.对比TCP连接</h2><p>在Socket编程时，都是一个server.py，一个client.py</p>
<p>server.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket() # 买手机</span><br><span class="line">sk.bind((&#x27;127.0.0.1&#x27;,9000)) # 绑定卡号</span><br><span class="line">sk.listen() # 开机</span><br><span class="line"></span><br><span class="line">conn,addr = sk.accept() # 等着接电话</span><br><span class="line">conn.send(b&#x27;hello&#x27;)</span><br><span class="line">msg = conn.recv(1024)</span><br><span class="line">print(msg)</span><br><span class="line"></span><br><span class="line">conn.close() # 挂电话</span><br><span class="line">sk.close() # 关机（释放端口资源）</span><br></pre></td></tr></table></figure>

<p>client.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">9000</span>))</span><br><span class="line"></span><br><span class="line">msg = sk.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(msg)</span><br><span class="line">sk.send(<span class="string">b&#x27;HTTP/1.1 200 OK\r\n\r\nHello World&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<p>当不通过浏览器解析，而直接通过TCP传输时，上述的响应首行，只会被解释成和<code>Hello World</code>一样的字符串</p>
<p><img src="https://img-blog.csdnimg.cn/050b58ae82754fff8bf68fa86687c715.png" alt="在这里插入图片描述"></p>
<p>所以说，Http是应用层协议</p>
<h2 id="1-3-新增web应用程序的功能"><a href="#1-3-新增web应用程序的功能" class="headerlink" title="1.3.新增web应用程序的功能"></a>1.3.新增web应用程序的功能</h2><h3 id="1-3-1-加粗标题"><a href="#1-3-1-加粗标题" class="headerlink" title="1.3.1.加粗标题"></a>1.3.1.加粗标题</h3><p>现在server提供的服务，仅仅是展示<code>Hello World</code>字符串</p>
<p>我们现在增加<code>&lt;h1&gt;</code>标签：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket()</span><br><span class="line">sock.bind((&#x27;127.0.0.1&#x27;,9090))</span><br><span class="line">sock.listen(5)</span><br><span class="line"></span><br><span class="line">while 1:</span><br><span class="line">    print(&#x27;server waiting...&#x27;)</span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line">    data = conn.recv(1024)</span><br><span class="line">    print(&#x27;data:&#x27;,data)</span><br><span class="line">    # 响应首行和响应体之间，用\r\n\r\n隔开</span><br><span class="line">    conn.send(b&#x27;HTTP/1.1 200 OK\r\n\r\n&lt;h1&gt;Hello World&lt;/h1&gt;&#x27;)</span><br><span class="line"></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>显示如下：</p>
<p><img src="https://img-blog.csdnimg.cn/1085104df1b24fba800d7a5d1d097649.png" alt="在这里插入图片描述"></p>
<p>浏览器<code>Preview</code>展示的，其实就是最上面的<code>Hello World</code></p>
<p>而<code>Response</code>，则是传给浏览器引擎的数据，即含有<code>html</code>标签的数据</p>
<p>那么，<code>HTTP/1.1 200 OK\r\n\r\n</code>，则是在服务器传给浏览器，经过Http协议解析了</p>
<p>所以，<code>HTTP/1.1 200 OK\r\n\r\n&lt;h1&gt;Hello World&lt;/1&gt;</code>这个字符串的解析顺序如下：</p>
<p>只考虑数据达到浏览器后，该层属于应用层，发现是HTTP协议头，于是按照Http协议进行解析，解析完的数据给浏览器这个应用程序</p>
<p>浏览器应用程序，对<code>&lt;h1&gt;Hello World&lt;/1&gt;</code>进行解析，经过浏览器引擎渲染，最终是加粗的<code>Hello World</code>效果</p>
<h3 id="1-3-2-加上图片"><a href="#1-3-2-加上图片" class="headerlink" title="1.3.2.加上图片"></a>1.3.2.加上图片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket()</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">9090</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;server waiting...&#x27;</span>)</span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;data:&#x27;</span>,data)</span><br><span class="line">    <span class="comment"># 响应首行和响应体之间，用\r\n\r\n隔开</span></span><br><span class="line">    conn.send(<span class="string">b&#x27;HTTP/1.1 200 OK\r\n\r\n&lt;h1&gt;Hello World&lt;/h1&gt;&lt;img src=&quot;https://img2.baidu.com/it/u=1170422687,3709426869&amp;fm=26&amp;fmt=auto&quot;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>显示效果：</p>
<p><img src="https://img-blog.csdnimg.cn/42824bba773042e095e9333f3f8e4d59.png" alt="在这里插入图片描述"></p>
<p>渲染过程和之前一样，只不过又向百度的服务器发了一个请求</p>
<h3 id="1-3-3-封装前端代码"><a href="#1-3-3-封装前端代码" class="headerlink" title="1.3.3.封装前端代码"></a>1.3.3.封装前端代码</h3><p>一个页面是由很多这样的标签语言的，如果都写在<code>send()</code>方法中，既累人又不易于维护</p>
<p>所以我们先写html代码，然后把从html文件中，读取出来给send就可以了</p>
<p>新建<code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img2.baidu.com/it/u=1170422687,3709426869&amp;fm=26&amp;fmt=auto&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>server.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket()</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">9090</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;server waiting...&#x27;</span>)</span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;data:&#x27;</span>,data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;index.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fr:</span><br><span class="line">        response = fr.read()</span><br><span class="line">    <span class="comment"># 响应首行和响应体之间，用\r\n\r\n隔开</span></span><br><span class="line">    conn.send((<span class="string">&#x27;HTTP/1.1 200 OK\r\n\r\n%s&#x27;</span>%response).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>



<h1 id="2-Http协议"><a href="#2-Http协议" class="headerlink" title="2.Http协议"></a>2.Http协议</h1><p>详细参见《阅读笔记《图解HTTP》.md》：<a target="_blank" rel="noopener" href="https://gitee.com/mindcons-g/network/blob/master/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E3%80%8A%E5%9B%BE%E8%A7%A3HTTP%E3%80%8B.md">https://gitee.com/mindcons-g/network/blob/master/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E3%80%8A%E5%9B%BE%E8%A7%A3HTTP%E3%80%8B.md</a></p>
<h2 id="2-1-请求协议"><a href="#2-1-请求协议" class="headerlink" title="2.1.请求协议"></a>2.1.请求协议</h2><h3 id="2-1-1-get请求"><a href="#2-1-1-get请求" class="headerlink" title="2.1.1.get请求"></a>2.1.1.get请求</h3><p>请求格式</p>
<p><img src="https://img-blog.csdnimg.cn/0dc2f712e7bd4d67940f928db0fd3191.png" alt="在这里插入图片描述"></p>
<p>请求方式：get与post请求</p>
<ul>
<li>GET提交的数据会放在URL之后，以<code>？</code>分割URL和传输数据，参数之间以<code>&amp;</code>相连，如<code>EditBook?name=test&amp;id=123456</code></li>
<li>POST方法是把提交的数据放在HTTP包的请求体中</li>
<li>GET提交的数据有大小限制（因为浏览器对URL长度有限制），而POST方法提交的数据没有限制</li>
<li>GET于POST请求在服务器端获取请求数据方式不同</li>
</ul>
<p>我们再来详细分析一下，传递给服务器的data值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server waiting...</span><br><span class="line">data: b&#x27;GET /favicon.ico HTTP/1.1\r\nHost: 127.0.0.1:9090\r\nConnection: keep-alive\r\nPragma: no-cache\r\nCache-Control: no-cache\r\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3877.400 QQBrowser/10.8.4506.400\r\nAccept: image/webp,image/apng,image/*,*/*;q=0.8\r\nReferer: http://127.0.0.1:9090/\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: zh-CN,zh;q=0.9\r\n\r\n&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>两个<code>\r\n</code>分割的是请求头和请求体，只有POST才有请求体</p>
<p>对于请求报文，可以简单理解为，就是前段传给服务的一段字符串，以一定的格式组织了一定的信息</p>
<h3 id="2-1-2-post请求"><a href="#2-1-2-post请求" class="headerlink" title="2.1.2.post请求"></a>2.1.2.post请求</h3><p>我们构建一个post请求</p>
<p><code>post_test.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:9090/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    用户名 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    密码 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>server.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket()</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">9090</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;server waiting...&#x27;</span>)</span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;data:&#x27;</span>,data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;post_test.html&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fr:</span><br><span class="line">        response = fr.read()</span><br><span class="line">    conn.send(<span class="string">b&#x27;HTTP/1.1 200 OK\r\n\r\n%s&#x27;</span>%response)</span><br></pre></td></tr></table></figure>

<p>前台显示：</p>
<p><img src="https://img-blog.csdnimg.cn/d22ac988630e444fb47521e21b90363c.png" alt="在这里插入图片描述"></p>
<p>我们填写一下并提交，看一下后台：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data: b&#x27;POST / HTTP/1.1\r\nHost: 127.0.0.1:9090\r\nConnection: keep-alive\r\nContent-Length: 20\r\nCache-Control: max-age=0\r\nUpgrade-Insecure-Requests: 1\r\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3877.400 QQBrowser/10.8.4506.400\r\nOrigin: http://127.0.0.1:9090\r\nContent-Type: application/x-www-form-urlencoded\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\r\nReferer: http://127.0.0.1:9090/\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: zh-CN,zh;q=0.9\r\n\r\nuser=test&amp;pwd=123445&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>POST请求的最后，是有请求体数据的：<code>user=test&amp;pwd=123445</code></p>
<h2 id="2-2-响应协议"><a href="#2-2-响应协议" class="headerlink" title="2.2.响应协议"></a>2.2.响应协议</h2><h3 id="2-2-1-响应报文构成"><a href="#2-2-1-响应报文构成" class="headerlink" title="2.2.1.响应报文构成"></a>2.2.1.响应报文构成</h3><p><img src="https://img-blog.csdnimg.cn/acc4da7250c54ca98e7552cb1d9856d3.png" alt="在这里插入图片描述"></p>
<p>具体到代码层面：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conn.send(<span class="string">b&#x27;HTTP/1.1 200 OK\r\n\r\n%s&#x27;</span>%response)</span><br><span class="line"></span><br><span class="line">conn.send(<span class="string">b&#x27;HTTP/1.1 200 OK\r\nContent-Type:text/html\r\n\r\n%s&#x27;</span>%response)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-1响应状态码"><a href="#2-2-1响应状态码" class="headerlink" title="2.2.1响应状态码"></a>2.2.1响应状态码</h3><p>状态码的职责是，当客户端向服务端发送请求时，返回的请求结果。</p>
<p>借助状态码，用户可以知道服务器是正常处理了请求，还是出现了错误。</p>
<p>状态码，如<code>200</code>表示<code>OK</code>，是以3位数字和原因短语构成的，响应状态码分别有以下5种：</p>
<p><img src="https://img-blog.csdnimg.cn/6d6513396f8744f695b6094fe36b5683.png" alt="在这里插入图片描述"></p>
<h1 id="3-wsgiref模块"><a href="#3-wsgiref模块" class="headerlink" title="3.wsgiref模块"></a>3.wsgiref模块</h1><h2 id="3-1-web框架"><a href="#3-1-web框架" class="headerlink" title="3.1.web框架"></a>3.1.web框架</h2><p>Web框架（Web framework）是一种开发框架，用来支持动态网站、网络应用和网络服务的开发。这大多数的web框架提供了一套开发和部署网站的方式，也为web行为提供了一套通用的方法。web框架已经实现了很多功能，开发人员使用框架提供的方法并且完成自己的业务逻辑，就能快速开发web应用了。浏览器和服务器的是基于HTTP协议进行通信的。也可以说web框架就是在以上十几行代码基础张扩展出来的，有很多简单方便使用的方法，大大提高了开发的效率。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    <span class="comment"># 按着http协议解析数据，所有解析好的data，存在environ中：environ</span></span><br><span class="line">    <span class="comment"># 按着http协议组装数据:start_response</span></span><br><span class="line">    start_response(<span class="string">&#x27;200 OK&#x27;</span>, [(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>)])</span><br><span class="line">    <span class="built_in">print</span>(environ)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(environ))</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&#x27;&lt;h1&gt;Hello, web!&lt;/h1&gt;&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装socket</span></span><br><span class="line">httpd = make_server(<span class="string">&#x27;&#x27;</span>, <span class="number">8080</span>, application)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Serving HTTP on port 8000...&#x27;</span>)</span><br><span class="line"><span class="comment"># 开始监听HTTP请求，等待用户连接:</span></span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>

<p><code>environ</code>中有一个<code>PATH_INFO</code>的键，保存着当前访问路径</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(environ)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(environ))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取当前请求路径</span></span><br><span class="line">    path = environ.get(<span class="string">&#x27;PATH_INFO&#x27;</span>)</span><br><span class="line">    start_response(<span class="string">&#x27;200 OK&#x27;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">&#x27;/login&#x27;</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;login.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fr:</span><br><span class="line">            data = fr.read()</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">&#x27;/index&#x27;</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;index.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fr:</span><br><span class="line">            data = fr.read()</span><br><span class="line">    <span class="keyword">return</span> [data.encode(<span class="string">&#x27;utf-8&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">httpd = make_server(<span class="string">&#x27;&#x27;</span>, <span class="number">8090</span>, application)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Serving HTTP on port 8090...&#x27;</span>)</span><br><span class="line"><span class="comment"># 开始监听HTTP请求:</span></span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>

<p>我们可以根据访问路径的不同，给用户返回不同的页面</p>
<h1 id="4-DIY一个web框架"><a href="#4-DIY一个web框架" class="headerlink" title="4.DIY一个web框架"></a>4.DIY一个web框架</h1><h2 id="4-1-方案一"><a href="#4-1-方案一" class="headerlink" title="4.1.方案一"></a>4.1.方案一</h2><h2 id="4-2-方案二"><a href="#4-2-方案二" class="headerlink" title="4.2.方案二"></a>4.2.方案二</h2><h2 id="4-3-解耦"><a href="#4-3-解耦" class="headerlink" title="4.3.解耦"></a>4.3.解耦</h2><h2 id="4-4-什么是框架"><a href="#4-4-什么是框架" class="headerlink" title="4.4.什么是框架"></a>4.4.什么是框架</h2><p>反复要写的，必写的，琐碎的内容，由框架先写好</p>
<p>框架，就是一个文件夹（包）而已，里面每个文件（夹）都有各自的功能</p>
<p>程序员只要专注业务逻辑的编码</p>
<h2 id="4-5-关于数据库的操作（核心）"><a href="#4-5-关于数据库的操作（核心）" class="headerlink" title="4.5.关于数据库的操作（核心）"></a>4.5.关于数据库的操作（核心）</h2><p>之前的代码，真正跑起来，只有<code>main.py</code>一个文件</p>
<p>注册页面，需要用数据库，存放用户数据</p>
<p>登陆页面，需要和数据库里的内容验证</p>
<p><code>models.py</code>作用：在项目启动前，生成表结构</p>
<h2 id="4-6-web-框架功能总结"><a href="#4-6-web-框架功能总结" class="headerlink" title="4.6.web 框架功能总结"></a>4.6.web 框架功能总结</h2><h1 id="5-Django简介"><a href="#5-Django简介" class="headerlink" title="5.Django简介"></a>5.Django简介</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuanchenqi/articles/8875659.html">https://www.cnblogs.com/yuanchenqi/articles/8875659.html</a></p>
<h2 id="5-1-MVC与MTV模型"><a href="#5-1-MVC与MTV模型" class="headerlink" title="5.1.MVC与MTV模型"></a>5.1.MVC与MTV模型</h2><p>模型概念的衍生</p>
<h2 id="5-2-Django下载与基本命令"><a href="#5-2-Django下载与基本命令" class="headerlink" title="5.2.Django下载与基本命令"></a>5.2.Django下载与基本命令</h2><h2 id="5-3-Django简单示例"><a href="#5-3-Django简单示例" class="headerlink" title="5.3.Django简单示例"></a>5.3.Django简单示例</h2><p>基本流程演示</p>
<h2 id="5-4-静态文件配置"><a href="#5-4-静态文件配置" class="headerlink" title="5.4.静态文件配置"></a>5.4.静态文件配置</h2><h3 id="5-4-1-static配置"><a href="#5-4-1-static配置" class="headerlink" title="5.4.1.static配置"></a>5.4.1.static配置</h3><p><code>settings.py</code>的最后添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR,<span class="string">&#x27;static&#x27;</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>然后在manage.py的同级目录下，创建<code>static</code>文件夹，也可以放在app的目录下</p>
<p>在html中就可以引用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/plugin/bootstrap/css/bootstrap.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="5-5-路由控制"><a href="#5-5-路由控制" class="headerlink" title="5.5.路由控制"></a>5.5.路由控制</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuanchenqi/articles/8931472.html">https://www.cnblogs.com/yuanchenqi/articles/8931472.html</a></p>
<h3 id="5-5-1-简单配置"><a href="#5-5-1-简单配置" class="headerlink" title="5.5.1.简单配置"></a>5.5.1.简单配置</h3><p>request</p>
<p>Httpresponse</p>
<p>re_path中的正则</p>
<p>正则中只要分组了，就会作为位置参数，传递给视图函数</p>
<p>正则和视图函数的关系，是多对一</p>
<p>若有两个正则，同时匹配了，会走先匹配的视图函数</p>
<h3 id="5-5-2-有名分组"><a href="#5-5-2-有名分组" class="headerlink" title="5.5.2.有名分组"></a>5.5.2.有名分组</h3><p><code>？P&lt;&gt;</code>固定写法，相当于起了个别名</p>
<p>re_path(r’)</p>
<h3 id="5-5-3-路由分发"><a href="#5-5-3-路由分发" class="headerlink" title="5.5.3.路由分发"></a>5.5.3.路由分发</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">At any point, your urlpatterns can “include” other URLconf modules. This</span></span><br><span class="line"><span class="string">essentially “roots” a set of URLs below other ones.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path,include</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">   re_path(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">   re_path(<span class="string">r&#x27;^blog/&#x27;</span>, include(<span class="string">&#x27;blog.urls&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="5-5-4-登陆验证示例"><a href="#5-5-4-登陆验证示例" class="headerlink" title="5.5.4.登陆验证示例"></a>5.5.4.登陆验证示例</h3><p>在视图函数中，进行http请求类别的判断，以进行不同的行为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(request.GET)</span><br><span class="line">        <span class="built_in">print</span>(request.POST)</span><br><span class="line">        <span class="comment"># 取字典的方式取值</span></span><br><span class="line">        user = request.POST.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">        pwd request.POST.get(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;OK&quot;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="5-5-5-反向解析"><a href="#5-5-5-反向解析" class="headerlink" title="5.5.5.反向解析"></a>5.5.5.反向解析</h3><p>路由的名字，在实际开发的时候，并不是一成不变的</p>
<p>html中的反向解析</p>
<p>视图函数中的反向解析</p>
<p>反向解析中，如果还有正则，则需要加<code>args</code>参数</p>
<p>只要设置了别名，就可以反向解析到url，只要有args参数，就可以替换掉url中的正则</p>
<h3 id="5-5-6-名称空间"><a href="#5-5-6-名称空间" class="headerlink" title="5.5.6.名称空间"></a>5.5.6.名称空间</h3><p>多个app中，可能有相同的别名</p>
<h3 id="5-5-7-path方法"><a href="#5-5-7-path方法" class="headerlink" title="5.5.7.path方法"></a>5.5.7.path方法</h3><h4 id="5-5-7-1-内置转换器"><a href="#5-5-7-1-内置转换器" class="headerlink" title="5.5.7.1.内置转换器"></a>5.5.7.1.内置转换器</h4><h4 id="5-5-7-2-自定义转换器"><a href="#5-5-7-2-自定义转换器" class="headerlink" title="5.5.7.2.自定义转换器"></a>5.5.7.2.自定义转换器</h4><p>对于一些复杂或者复用的需要，可以定义自己的转化器。转化器是一个类或接口，它的要求有三点：</p>
<ul>
<li><p><code>regex</code> 类属性，字符串类型</p>
</li>
<li><p><code>to_python(self, value)</code> 方法，value是由类属性 <code>regex</code> 所匹配到的字符串，返回具体的Python变量值，以供Django传递到对应的视图函数中。</p>
</li>
<li><p><code>to_url(self, value)</code> 方法，和 <code>to_python</code> 相反，value是一个具体的Python变量值，返回其字符串，通常用于url反向引用。</p>
</li>
</ul>
<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FourDigitYearConverter</span>:  </span><br><span class="line">    regex = <span class="string">&#x27;[0-9]&#123;4&#125;&#x27;</span>  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_python</span>(<span class="params">self, value</span>):  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(value)  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_url</span>(<span class="params">self, value</span>):  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;%04d&#x27;</span> % value  </span><br></pre></td></tr></table></figure>

<p>使用<code>register_converter</code> 将其注册到URL配置中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> register_converter, path  </span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> converters, views  </span><br><span class="line">register_converter(converters.FourDigitYearConverter, <span class="string">&#x27;yyyy&#x27;</span>)  </span><br><span class="line">urlpatterns = [  </span><br><span class="line">    path(<span class="string">&#x27;articles/2003/&#x27;</span>, views.special_case_2003),  </span><br><span class="line">    path(<span class="string">&#x27;articles/&lt;yyyy:year&gt;/&#x27;</span>, views.year_archive),  </span><br><span class="line">    ...  </span><br><span class="line">]  </span><br></pre></td></tr></table></figure>

<h2 id="5-6-视图"><a href="#5-6-视图" class="headerlink" title="5.6.视图"></a>5.6.视图</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuanchenqi/articles/8876856.html">https://www.cnblogs.com/yuanchenqi/articles/8876856.html</a></p>
<p>一个视图函数，简称视图，是一个简单的Python 函数，它接受Web请求并且返回Web响应。响应可以是一张网页的HTML内容，一个重定向，一个404错误，一个XML文档，或者一张图片. . . 是任何东西都可以。无论视图本身包含什么逻辑，都要返回响应。代码写在哪里也无所谓，只要它在你的Python目录下面。除此之外没有更多的要求了——可以说“没有什么神奇的地方”。为了将代码放在某处，约定是将视图放置在项目或应用程序目录中的名为<code>views.py</code>的文件中。</p>
<p>下面是一个返回当前日期和时间作为HTML文档的视图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, HttpResponseRedirect, redirect</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_datetime</span>(<span class="params">request</span>):</span><br><span class="line">    now = datetime.datetime.now()</span><br><span class="line">    html = <span class="string">&quot;&lt;html&gt;&lt;body&gt;It is now %s.&lt;/body&gt;&lt;/html&gt;&quot;</span> % now</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure>



<h3 id="5-6-1-请求对象"><a href="#5-6-1-请求对象" class="headerlink" title="5.6.1.请求对象"></a>5.6.1.请求对象</h3><h4 id="5-6-1-1-request属性"><a href="#5-6-1-1-request属性" class="headerlink" title="5.6.1.1.request属性"></a>5.6.1.1.request属性</h4><p>django将请求报文中的请求行、首部信息、内容主体封装成 HttpRequest 类中的属性。 除了特殊说明的之外，其他均为只读的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>HttpRequest.GET</span><br><span class="line"></span><br><span class="line">　　一个类似于字典的对象，包含 HTTP GET 的所有参数。详情请参考 QueryDict 对象。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>HttpRequest.POST</span><br><span class="line"></span><br><span class="line">　　一个类似于字典的对象，如果请求中包含表单数据，则将这些数据封装成 QueryDict 对象。</span><br><span class="line"></span><br><span class="line">　　POST 请求可以带有空的 POST 字典 —— 如果通过 HTTP POST 方法发送一个表单，但是表单中没有任何的数据，QueryDict 对象依然会被创建。</span><br><span class="line">   因此，不应该使用 <span class="keyword">if</span> request.POST  来检查使用的是否是POST 方法；应该使用 <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span></span><br><span class="line">　　另外：如果使用 POST 上传文件的话，文件信息将包含在 FILES 属性中。</span><br><span class="line">   </span><br><span class="line">   注意：键值对的值是多个的时候,比如checkbox类型的<span class="built_in">input</span>标签，select标签，需要用：</span><br><span class="line">        request.POST.getlist(<span class="string">&quot;hobby&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>HttpRequest.body</span><br><span class="line"></span><br><span class="line">　　一个字符串，代表请求报文的主体。在处理非 HTTP 形式的报文时非常有用，例如：二进制图片、XML,Json等。</span><br><span class="line">　　但是，如果要处理表单数据的时候，推荐还是使用 HttpRequest.POST 。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>HttpRequest.path</span><br><span class="line"></span><br><span class="line">　　一个字符串，表示请求的路径组件（不含域名）。</span><br><span class="line">　　例如：<span class="string">&quot;/music/bands/the_beatles/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>HttpRequest.method</span><br><span class="line"></span><br><span class="line">　　一个字符串，表示请求使用的HTTP 方法。必须使用大写。</span><br><span class="line">　　例如：<span class="string">&quot;GET&quot;</span>、<span class="string">&quot;POST&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>HttpRequest.encoding</span><br><span class="line"></span><br><span class="line">　　一个字符串，表示提交的数据的编码方式（如果为 <span class="literal">None</span> 则表示使用 DEFAULT_CHARSET 的设置，默认为 <span class="string">&#x27;utf-8&#x27;</span>）。</span><br><span class="line">   这个属性是可写的，你可以修改它来修改访问表单数据使用的编码。</span><br><span class="line">   接下来对属性的任何访问（例如从 GET 或 POST 中读取数据）将使用新的 encoding 值。</span><br><span class="line">   如果你知道表单数据的编码不是 DEFAULT_CHARSET ，则使用它。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>HttpRequest.META</span><br><span class="line"></span><br><span class="line"> 　　一个标准的Python 字典，包含所有的HTTP 首部。具体的头部信息取决于客户端和服务器，下面是一些示例：</span><br><span class="line"></span><br><span class="line">    CONTENT_LENGTH —— 请求的正文的长度（是一个字符串）。</span><br><span class="line">    CONTENT_TYPE —— 请求的正文的MIME 类型。</span><br><span class="line">    HTTP_ACCEPT —— 响应可接收的Content-<span class="type">Type</span>。</span><br><span class="line">    HTTP_ACCEPT_ENCODING —— 响应可接收的编码。</span><br><span class="line">    HTTP_ACCEPT_LANGUAGE —— 响应可接收的语言。</span><br><span class="line">    HTTP_HOST —— 客服端发送的HTTP Host 头部。</span><br><span class="line">    HTTP_REFERER —— Referring 页面。</span><br><span class="line">    HTTP_USER_AGENT —— 客户端的user-agent 字符串。</span><br><span class="line">    QUERY_STRING —— 单个字符串形式的查询字符串（未解析过的形式）。</span><br><span class="line">    REMOTE_ADDR —— 客户端的IP 地址。</span><br><span class="line">    REMOTE_HOST —— 客户端的主机名。</span><br><span class="line">    REMOTE_USER —— 服务器认证后的用户。</span><br><span class="line">    REQUEST_METHOD —— 一个字符串，例如<span class="string">&quot;GET&quot;</span> 或<span class="string">&quot;POST&quot;</span>。</span><br><span class="line">    SERVER_NAME —— 服务器的主机名。</span><br><span class="line">    SERVER_PORT —— 服务器的端口（是一个字符串）。</span><br><span class="line"> 　　从上面可以看到，除 CONTENT_LENGTH 和 CONTENT_TYPE 之外，请求中的任何 HTTP 首部转换为 META 的键时，</span><br><span class="line">    都会将所有字母大写并将连接符替换为下划线最后加上 HTTP_  前缀。</span><br><span class="line">    所以，一个叫做 X-Bender 的头部将转换成 META 中的 HTTP_X_BENDER 键。</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>HttpRequest.FILES</span><br><span class="line"></span><br><span class="line">　　一个类似于字典的对象，包含所有的上传文件信息。</span><br><span class="line">   FILES 中的每个键为&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;&quot;</span> /&gt; 中的name，值则为对应的数据。</span><br><span class="line">　　注意，FILES 只有在请求的方法为POST 且提交的&lt;form&gt; 带有enctype=<span class="string">&quot;multipart/form-data&quot;</span> 的情况下才会</span><br><span class="line">   包含数据。否则，FILES 将为一个空的类似于字典的对象。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">9.</span>HttpRequest.COOKIES</span><br><span class="line"></span><br><span class="line">　　一个标准的Python 字典，包含所有的cookie。键和值都为字符串。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">10.</span>HttpRequest.session</span><br><span class="line"></span><br><span class="line"> 　　一个既可读又可写的类似于字典的对象，表示当前的会话。只有当Django 启用会话的支持时才可用。</span><br><span class="line">    完整的细节参见会话的文档。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">11.</span>HttpRequest.user(用户认证组件下使用)</span><br><span class="line"></span><br><span class="line">　　一个 AUTH_USER_MODEL 类型的对象，表示当前登录的用户。</span><br><span class="line"></span><br><span class="line">　　如果用户当前没有登录，user 将设置为 django.contrib.auth.models.AnonymousUser 的一个实例。你可以通过 is_authenticated() 区分它们。</span><br><span class="line"></span><br><span class="line">    例如：</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.user.is_authenticated():</span><br><span class="line">        <span class="comment"># Do something for logged-in users.</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># Do something for anonymous users.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     　　user 只有当Django 启用 AuthenticationMiddleware 中间件时才可用。</span><br><span class="line"></span><br><span class="line">     -------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">    匿名用户</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">models</span>.AnonymousUser</span><br><span class="line"></span><br><span class="line">    django.contrib.auth.models.AnonymousUser 类实现了django.contrib.auth.models.User 接口，但具有下面几个不同点：</span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span> 永远为<span class="literal">None</span>。</span><br><span class="line">    username 永远为空字符串。</span><br><span class="line">    get_username() 永远返回空字符串。</span><br><span class="line">    is_staff 和 is_superuser 永远为<span class="literal">False</span>。</span><br><span class="line">    is_active 永远为 <span class="literal">False</span>。</span><br><span class="line">    groups 和 user_permissions 永远为空。</span><br><span class="line">    is_anonymous() 返回<span class="literal">True</span> 而不是<span class="literal">False</span>。</span><br><span class="line">    is_authenticated() 返回<span class="literal">False</span> 而不是<span class="literal">True</span>。</span><br><span class="line">    set_password()、check_password()、save() 和delete() 引发 NotImplementedError。</span><br><span class="line">    New <span class="keyword">in</span> Django <span class="number">1.8</span>:</span><br><span class="line">    新增 AnonymousUser.get_username() 以更好地模拟 django.contrib.auth.models.User。</span><br><span class="line"></span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h4 id="5-6-1-2-request常用方法"><a href="#5-6-1-2-request常用方法" class="headerlink" title="5.6.1.2.request常用方法"></a>5.6.1.2.request常用方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>HttpRequest.get_full_path()</span><br><span class="line"></span><br><span class="line">　　返回 path，如果可以将加上查询字符串。</span><br><span class="line"></span><br><span class="line">　　例如：<span class="string">&quot;/music/bands/the_beatles/?print=true&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>HttpRequest.is_ajax()</span><br><span class="line"></span><br><span class="line">　　如果请求是通过XMLHttpRequest 发起的，则返回<span class="literal">True</span>，方法是检查 HTTP_X_REQUESTED_WITH 相应的首部是否是字符串<span class="string">&#x27;XMLHttpRequest&#x27;</span>。</span><br><span class="line"></span><br><span class="line">　　大部分现代的 JavaScript 库都会发送这个头部。如果你编写自己的 XMLHttpRequest 调用（在浏览器端），你必须手工设置这个值来让 is_ajax() 可以工作。</span><br><span class="line"></span><br><span class="line">　　如果一个响应需要根据请求是否是通过AJAX 发起的，并且你正在使用某种形式的缓存例如Django 的 cache middleware，</span><br><span class="line">   你应该使用 vary_on_headers(<span class="string">&#x27;HTTP_X_REQUESTED_WITH&#x27;</span>) 装饰你的视图以让响应能够正确地缓存。</span><br><span class="line"></span><br><span class="line">*/</span><br></pre></td></tr></table></figure>



<h3 id="5-6-2-响应对象"><a href="#5-6-2-响应对象" class="headerlink" title="5.6.2.响应对象"></a>5.6.2.响应对象</h3><p>响应对象主要有三种形式：</p>
<ul>
<li>HttpResponse()</li>
<li>render()</li>
<li>redirect()</li>
</ul>
<p>HttpResponse()括号内直接跟一个具体的字符串作为响应体，比较直接很简单，所以这里主要介绍后面两种形式。</p>
<h4 id="5-6-2-1-render"><a href="#5-6-2-1-render" class="headerlink" title="5.6.2.1.render()"></a>5.6.2.1.render()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render(request, template_name[, context]）</span><br><span class="line"> </span><br><span class="line">结合一个给定的模板和一个给定的上下文字典，并返回一个渲染后的 HttpResponse 对象。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">     request： 用于生成响应的请求对象。</span><br><span class="line"></span><br><span class="line">     template_name：要使用的模板的完整名称，可选的参数</span><br><span class="line"></span><br><span class="line">     context：添加到模板上下文的一个字典。默认是一个空字典。如果字典中的某个值是可调用的，视图将在渲染模板之前调用它。render方法就是将一个模板页面中的模板语法进行渲染，最终渲染成一个html页面作为响应体。</span><br></pre></td></tr></table></figure>

<h4 id="5-6-2-2-redirect"><a href="#5-6-2-2-redirect" class="headerlink" title="5.6.2.2.redirect()"></a>5.6.2.2.redirect()</h4><p>传递要重定向的一个硬编码的URL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def my_view(request):</span><br><span class="line">    ...</span><br><span class="line">    return redirect(&#x27;/some/url/&#x27;)</span><br></pre></td></tr></table></figure>

<p>也可以是一个完整的URL：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def my_view(request):</span><br><span class="line">    ...</span><br><span class="line">    return redirect(&#x27;http://example.com/&#x27;)　</span><br></pre></td></tr></table></figure>

<p>key：两次请求　</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1）301和302的区别。</span><br><span class="line"></span><br><span class="line">　　301和302状态码都表示重定向，就是说浏览器在拿到服务器返回的这个状态码后会自动跳转到一个新的URL地址，这个地址可以从响应的Location首部中获取</span><br><span class="line">  （用户看到的效果就是他输入的地址A瞬间变成了另一个地址B）——这是它们的共同点。</span><br><span class="line"></span><br><span class="line">　　他们的不同在于。301表示旧地址A的资源已经被永久地移除了（这个资源不可访问了），搜索引擎在抓取新内容的同时也将旧的网址交换为重定向之后的网址；</span><br><span class="line"></span><br><span class="line">　　302表示旧地址A的资源还在（仍然可以访问），这个重定向只是临时地从旧地址A跳转到地址B，搜索引擎会抓取新的内容而保存旧的网址。 SEO302好于301</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">2）重定向原因：</span><br><span class="line">（1）网站调整（如改变网页目录结构）；</span><br><span class="line">（2）网页被移到一个新地址；</span><br><span class="line">（3）网页扩展名改变(如应用需要把.php改成.Html或.shtml)。</span><br><span class="line">        这种情况下，如果不做重定向，则用户收藏夹或搜索引擎数据库中旧地址只能让访问客户得到一个404页面错误信息，访问流量白白丧失；再者某些注册了多个域名的</span><br><span class="line">    网站，也需要通过重定向让访问这些域名的用户自动跳转到主站点等。</span><br><span class="line"></span><br><span class="line">关于301与302</span><br></pre></td></tr></table></figure>

<p>用redirect可以解释APPEND_SLASH的用法！</p>
<h2 id="5-7-模板语法"><a href="#5-7-模板语法" class="headerlink" title="5.7.模板语法"></a>5.7.模板语法</h2><h3 id="5-7-1-变量"><a href="#5-7-1-变量" class="headerlink" title="5.7.1.变量"></a>5.7.1.变量</h3><h3 id="5-7-2-过滤器"><a href="#5-7-2-过滤器" class="headerlink" title="5.7.2.过滤器"></a>5.7.2.过滤器</h3><h3 id="5-7-3-标签"><a href="#5-7-3-标签" class="headerlink" title="5.7.3.标签"></a>5.7.3.标签</h3><h3 id="5-7-4-自定义标签和过滤器"><a href="#5-7-4-自定义标签和过滤器" class="headerlink" title="5.7.4.自定义标签和过滤器"></a>5.7.4.自定义标签和过滤器</h3><h3 id="5-7-5-继承"><a href="#5-7-5-继承" class="headerlink" title="5.7.5.继承"></a>5.7.5.继承</h3><h2 id="5-8-ORM"><a href="#5-8-ORM" class="headerlink" title="5.8.ORM"></a>5.8.ORM</h2><h3 id="5-8-1-ORM简介"><a href="#5-8-1-ORM简介" class="headerlink" title="5.8.1.ORM简介"></a>5.8.1.ORM简介</h3><ul>
<li>MVC或者MVC框架中包括一个重要的部分，就是ORM，它实现了数据模型与数据库的解耦，即数据模型的设计不需要依赖于特定的数据库，通过简单的配置就可以轻松更换数据库，这极大的减轻了开发人员的工作量，不需要面对因数据库变更而导致的无效劳动</li>
<li>ORM是“对象-关系-映射”的简称。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sql中的表                                                      </span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#创建表:</span></span><br><span class="line">     CREATE TABLE employee(                                     </span><br><span class="line">                <span class="built_in">id</span> INT PRIMARY KEY auto_increment ,                    </span><br><span class="line">                name VARCHAR (<span class="number">20</span>),                                      </span><br><span class="line">                gender BIT default <span class="number">1</span>,                                  </span><br><span class="line">                birthday DATA ,                                         </span><br><span class="line">                department VARCHAR (<span class="number">20</span>),                                </span><br><span class="line">                salary DECIMAL (<span class="number">8</span>,<span class="number">2</span>) unsigned,                          </span><br><span class="line">              );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">#sql中的表纪录                                                  </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#添加一条表纪录:                                                          </span></span><br><span class="line">      INSERT employee (name,gender,birthday,salary,department)            </span><br><span class="line">             VALUES   (<span class="string">&quot;alex&quot;</span>,<span class="number">1</span>,<span class="string">&quot;1985-12-12&quot;</span>,<span class="number">8000</span>,<span class="string">&quot;保洁部&quot;</span>);               </span><br><span class="line"></span><br><span class="line">  <span class="comment">#查询一条表纪录:                                                           </span></span><br><span class="line">      SELECT * FROM employee WHERE age=<span class="number">24</span>;                               </span><br><span class="line"></span><br><span class="line">  <span class="comment">#更新一条表纪录:                                                           </span></span><br><span class="line">      UPDATE employee SET birthday=<span class="string">&quot;1989-10-24&quot;</span> WHERE <span class="built_in">id</span>=<span class="number">1</span>;              </span><br><span class="line"></span><br><span class="line">  <span class="comment">#删除一条表纪录:                                                          </span></span><br><span class="line">      DELETE FROM employee WHERE name=<span class="string">&quot;alex&quot;</span>                             </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#python的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span>(models.Model):</span><br><span class="line">     <span class="built_in">id</span>=models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">     name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     gender=models.BooleanField()</span><br><span class="line">     birthday=models.DateField()</span><br><span class="line">     department=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     salary=models.DecimalField(max_digits=<span class="number">8</span>,decimal_places=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">#python的类对象</span></span><br><span class="line">      <span class="comment">#添加一条表纪录:</span></span><br><span class="line">          emp=Employee(name=<span class="string">&quot;alex&quot;</span>,gender=<span class="literal">True</span>,birthday=<span class="string">&quot;1985-12-12&quot;</span>,epartment=<span class="string">&quot;保洁部&quot;</span>)</span><br><span class="line">          emp.save()</span><br><span class="line">      <span class="comment">#查询一条表纪录:</span></span><br><span class="line">          Employee.objects.<span class="built_in">filter</span>(age=<span class="number">24</span>)</span><br><span class="line">      <span class="comment">#更新一条表纪录:</span></span><br><span class="line">          Employee.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(birthday=<span class="string">&quot;1989-10-24&quot;</span>)</span><br><span class="line">      <span class="comment">#删除一条表纪录:</span></span><br><span class="line">          Employee.objects.<span class="built_in">filter</span>(name=<span class="string">&quot;alex&quot;</span>).delete()</span><br></pre></td></tr></table></figure>



<h3 id="5-8-2-单表操作"><a href="#5-8-2-单表操作" class="headerlink" title="5.8.2.单表操作"></a>5.8.2.单表操作</h3><h4 id="5-8-2-1-创建表"><a href="#5-8-2-1-创建表" class="headerlink" title="5.8.2.1.创建表"></a>5.8.2.1.创建表</h4><h5 id="1-创建模型"><a href="#1-创建模型" class="headerlink" title="1.创建模型"></a>1.创建模型</h5><p>创建名为book的app，在book下的models.py中创建模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">     <span class="built_in">id</span>=models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">     title=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     state=models.BooleanField()</span><br><span class="line">     pub_date=models.DateField()</span><br><span class="line">     price=models.DecimalField(max_digits=<span class="number">8</span>,decimal_places=<span class="number">2</span>)</span><br><span class="line">     publish=models.CharField(max_length=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>

<h5 id="2-更多字段和参数"><a href="#2-更多字段和参数" class="headerlink" title="2 更多字段和参数"></a>2 更多字段和参数</h5><p>每个字段有一些特有的参数，例如，CharField需要max_length参数来指定<code>VARCHAR</code>数据库字段的大小。还有一些适用于所有字段的通用参数。 这些参数在文档中有详细定义，这里我们只简单介绍一些最常用的：</p>
<p><strong>更多字段：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"> </span><br><span class="line">&lt;1&gt; CharField</span><br><span class="line">        字符串字段, 用于较短的字符串.</span><br><span class="line">        CharField 要求必须有一个参数 maxlength, 用于从数据库层和Django校验层限制该字段所允许的最大字符数.</span><br><span class="line"> </span><br><span class="line">&lt;2&gt; IntegerField</span><br><span class="line">       #用于保存一个整数.</span><br><span class="line"> </span><br><span class="line">&lt;3&gt; FloatField</span><br><span class="line">        一个浮点数. 必须 提供两个参数:</span><br><span class="line">         </span><br><span class="line">        参数    描述</span><br><span class="line">        max_digits    总位数(不包括小数点和符号)</span><br><span class="line">        decimal_places    小数位数</span><br><span class="line">                举例来说, 要保存最大值为 999 (小数点后保存2位),你要这样定义字段:</span><br><span class="line">                 </span><br><span class="line">                models.FloatField(..., max_digits=5, decimal_places=2)</span><br><span class="line">                要保存最大值一百万(小数点后保存10位)的话,你要这样定义:</span><br><span class="line">                 </span><br><span class="line">                models.FloatField(..., max_digits=19, decimal_places=10)</span><br><span class="line">                admin 用一个文本框(&lt;input type=&quot;text&quot;&gt;)表示该字段保存的数据.</span><br><span class="line"> </span><br><span class="line">&lt;4&gt; AutoField</span><br><span class="line">        一个 IntegerField, 添加记录时它会自动增长. 你通常不需要直接使用这个字段;</span><br><span class="line">        自定义一个主键：my_id=models.AutoField(primary_key=True)</span><br><span class="line">        如果你不指定主键的话,系统会自动添加一个主键字段到你的 model.</span><br><span class="line"> </span><br><span class="line">&lt;5&gt; BooleanField</span><br><span class="line">        A true/false field. admin 用 checkbox 来表示此类字段.</span><br><span class="line"> </span><br><span class="line">&lt;6&gt; TextField</span><br><span class="line">        一个容量很大的文本字段.</span><br><span class="line">        admin 用一个 &lt;textarea&gt; (文本区域)表示该字段数据.(一个多行编辑框).</span><br><span class="line"> </span><br><span class="line">&lt;7&gt; EmailField</span><br><span class="line">        一个带有检查Email合法性的 CharField,不接受 maxlength 参数.</span><br><span class="line"> </span><br><span class="line">&lt;8&gt; DateField</span><br><span class="line">        一个日期字段. 共有下列额外的可选参数:</span><br><span class="line">        Argument    描述</span><br><span class="line">        auto_now    当对象被保存时,自动将该字段的值设置为当前时间.通常用于表示 &quot;last-modified&quot; 时间戳.</span><br><span class="line">        auto_now_add    当对象首次被创建时,自动将该字段的值设置为当前时间.通常用于表示对象创建时间.</span><br><span class="line">        （仅仅在admin中有意义...)</span><br><span class="line"> </span><br><span class="line">&lt;9&gt; DateTimeField</span><br><span class="line">         一个日期时间字段. 类似 DateField 支持同样的附加选项.</span><br><span class="line"> </span><br><span class="line">&lt;10&gt; ImageField</span><br><span class="line">        类似 FileField, 不过要校验上传对象是否是一个合法图片.#它有两个可选参数:height_field和width_field,</span><br><span class="line">        如果提供这两个参数,则图片将按提供的高度和宽度规格保存.    </span><br><span class="line">&lt;11&gt; FileField</span><br><span class="line">     一个文件上传字段.</span><br><span class="line">     要求一个必须有的参数: upload_to, 一个用于保存上载文件的本地文件系统路径. 这个路径必须包含 strftime #formatting,</span><br><span class="line">     该格式将被上载文件的 date/time</span><br><span class="line">     替换(so that uploaded files don&#x27;t fill up the given directory).</span><br><span class="line">     admin 用一个&lt;input type=&quot;file&quot;&gt;部件表示该字段保存的数据(一个文件上传部件) .</span><br><span class="line"> </span><br><span class="line">     注意：在一个 model 中使用 FileField 或 ImageField 需要以下步骤:</span><br><span class="line">            （1）在你的 settings 文件中, 定义一个完整路径给 MEDIA_ROOT 以便让 Django在此处保存上传文件.</span><br><span class="line">            (出于性能考虑,这些文件并不保存到数据库.) 定义MEDIA_URL 作为该目录的公共 URL. 要确保该目录对</span><br><span class="line">             WEB服务器用户帐号是可写的.</span><br><span class="line">            （2） 在你的 model 中添加 FileField 或 ImageField, 并确保定义了 upload_to 选项,以告诉 Django</span><br><span class="line">             使用 MEDIA_ROOT 的哪个子目录保存上传文件.你的数据库中要保存的只是文件的路径(相对于 MEDIA_ROOT).</span><br><span class="line">             出于习惯你一定很想使用 Django 提供的 get_&lt;#fieldname&gt;_url 函数.举例来说,如果你的 ImageField</span><br><span class="line">             叫作 mug_shot, 你就可以在模板中以 &#123;&#123; object.#get_mug_shot_url &#125;&#125; 这样的方式得到图像的绝对路径.</span><br><span class="line"> </span><br><span class="line">&lt;12&gt; URLField</span><br><span class="line">      用于保存 URL. 若 verify_exists 参数为 True (默认), 给定的 URL 会预先检查是否存在( 即URL是否被有效装入且</span><br><span class="line">      没有返回404响应).</span><br><span class="line">      admin 用一个 &lt;input type=&quot;text&quot;&gt; 文本框表示该字段保存的数据(一个单行编辑框)</span><br><span class="line"> </span><br><span class="line">&lt;13&gt; NullBooleanField</span><br><span class="line">       类似 BooleanField, 不过允许 NULL 作为其中一个选项. 推荐使用这个字段而不要用 BooleanField 加 null=True 选项</span><br><span class="line">       admin 用一个选择框 &lt;select&gt; (三个可选择的值: &quot;Unknown&quot;, &quot;Yes&quot; 和 &quot;No&quot; ) 来表示这种字段数据.</span><br><span class="line"> </span><br><span class="line">&lt;14&gt; SlugField</span><br><span class="line">       &quot;Slug&quot; 是一个报纸术语. slug 是某个东西的小小标记(短签), 只包含字母,数字,下划线和连字符.#它们通常用于URLs</span><br><span class="line">       若你使用 Django 开发版本,你可以指定 maxlength. 若 maxlength 未指定, Django 会使用默认长度: 50.  #在</span><br><span class="line">       以前的 Django 版本,没有任何办法改变50 这个长度.</span><br><span class="line">       这暗示了 db_index=True.</span><br><span class="line">       它接受一个额外的参数: prepopulate_from, which is a list of fields from which to auto-#populate</span><br><span class="line">       the slug, via JavaScript,in the object&#x27;s admin form: models.SlugField</span><br><span class="line">       (prepopulate_from=(&quot;pre_name&quot;, &quot;name&quot;))prepopulate_from 不接受 DateTimeFields.</span><br><span class="line"> </span><br><span class="line">&lt;13&gt; XMLField</span><br><span class="line">        一个校验值是否为合法XML的 TextField,必须提供参数: schema_path, 它是一个用来校验文本的 RelaxNG schema #的文件系统路径.</span><br><span class="line"> </span><br><span class="line">&lt;14&gt; FilePathField</span><br><span class="line">        可选项目为某个特定目录下的文件名. 支持三个特殊的参数, 其中第一个是必须提供的.</span><br><span class="line">        参数    描述</span><br><span class="line">        path    必需参数. 一个目录的绝对文件系统路径. FilePathField 据此得到可选项目.</span><br><span class="line">        Example: &quot;/home/images&quot;.</span><br><span class="line">        match    可选参数. 一个正则表达式, 作为一个字符串, FilePathField 将使用它过滤文件名. </span><br><span class="line">        注意这个正则表达式只会应用到 base filename 而不是</span><br><span class="line">        路径全名. Example: &quot;foo.*\.txt^&quot;, 将匹配文件 foo23.txt 却不匹配 bar.txt 或 foo23.gif.</span><br><span class="line">        recursive可选参数.要么 True 要么 False. 默认值是 False. 是否包括 path 下面的全部子目录.</span><br><span class="line">        这三个参数可以同时使用.</span><br><span class="line">        match 仅应用于 base filename, 而不是路径全名. 那么,这个例子:</span><br><span class="line">        FilePathField(path=&quot;/home/images&quot;, match=&quot;foo.*&quot;, recursive=True)</span><br><span class="line">        ...会匹配 /home/images/foo.gif 而不匹配 /home/images/foo/bar.gif</span><br><span class="line"> </span><br><span class="line">&lt;15&gt; IPAddressField</span><br><span class="line">        一个字符串形式的 IP 地址, (i.e. &quot;24.124.1.30&quot;).</span><br><span class="line">&lt;16&gt; CommaSeparatedIntegerField</span><br><span class="line">        用于存放逗号分隔的整数值. 类似 CharField, 必须要有maxlength参数.</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#x27;&#x27;&#x27;　　</span><br></pre></td></tr></table></figure>

<p><strong>更多参数：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(1)null</span><br><span class="line"> </span><br><span class="line">如果为True，Django 将用NULL 来在数据库中存储空值。 默认值是 False.</span><br><span class="line"> </span><br><span class="line">(1)blank</span><br><span class="line"> </span><br><span class="line">如果为True，该字段允许不填。默认为False。</span><br><span class="line">要注意，这与 null 不同。null纯粹是数据库范畴的，而 blank 是数据验证范畴的。</span><br><span class="line">如果一个字段的blank=True，表单的验证将允许该字段是空值。如果字段的blank=False，该字段就是必填的。</span><br><span class="line"> </span><br><span class="line">(2)default</span><br><span class="line"> </span><br><span class="line">字段的默认值。可以是一个值或者可调用对象。如果可调用 ，每有新对象被创建它都会被调用。</span><br><span class="line"> </span><br><span class="line">(3)primary_key</span><br><span class="line"> </span><br><span class="line">如果为True，那么这个字段就是模型的主键。如果你没有指定任何一个字段的primary_key=True，</span><br><span class="line">Django 就会自动添加一个IntegerField字段做为主键，所以除非你想覆盖默认的主键行为，</span><br><span class="line">否则没必要设置任何一个字段的primary_key=True。</span><br><span class="line"> </span><br><span class="line">(4)unique</span><br><span class="line"> </span><br><span class="line">如果该值设置为 True, 这个数据字段的值在整张表中必须是唯一的</span><br><span class="line"> </span><br><span class="line">(5)choices</span><br><span class="line">由二元组组成的一个可迭代对象（例如，列表或元组），用来给字段提供选择项。 如果设置了choices ，默认的表单将是一个选择框而不是标准的文本框，&lt;br&gt;而且这个选择框的选项就是choices 中的选项。</span><br></pre></td></tr></table></figure>

<h5 id="3-settings配置"><a href="#3-settings配置" class="headerlink" title="3 settings配置"></a>3 settings配置</h5><p>若想将模型转为mysql数据库中的表，需要在settings中配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;bms&#x27;</span>,     　　 　  <span class="comment"># 要连接的数据库，连接前需要创建好</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,　　　　　　  <span class="comment"># 连接数据库的用户名</span></span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;&#x27;</span>,　　　　　　  <span class="comment"># 连接数据库的密码</span></span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;127.0.0.1&#x27;</span>,       <span class="comment"># 连接主机，默认本级</span></span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>：<span class="number">3306</span>    　　　     <span class="comment">#  端口 默认3306</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意1：NAME即数据库的名字，在mysql连接前该数据库必须已经创建，而上面的sqlite数据库下的db.sqlite3则是项目自动创建 USER和PASSWORD分别是数据库的用户名和密码。设置完后，再启动我们的Django项目前，我们需要激活我们的mysql。然后，启动项目，会报错：no module named MySQLdb 。这是因为django默认你导入的驱动是MySQLdb，可是MySQLdb 对于py3有很大问题，所以我们需要的驱动是PyMySQL 所以，我们只需要找到项目名文件下的__init__,在里面写入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<p>最后通过两条数据库迁移命令即可在指定的数据库中创建表 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>注意2:确保配置文件中的INSTALLED_APPS中写入我们创建的app名称</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;book&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注意3:如果报错如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django.core.exceptions.ImproperlyConfigured: mysqlclient 1.3.3 or newer is required; you have 0.7.11.None</span><br></pre></td></tr></table></figure>

<p>MySQLclient目前只支持到python3.4，因此如果使用的更高版本的python，需要修改如下：</p>
<p>通过查找路径C:\Programs\Python\Python36-32\Lib\site-packages\Django-2.0-py3.6.egg\django\db\backends\mysql<br>这个路径里的文件把</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> version &lt; (<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>):</span><br><span class="line">     <span class="keyword">raise</span> ImproperlyConfigured(<span class="string">&quot;mysqlclient 1.3.3 or newer is required; you have %s&quot;</span> % Database.__version__)</span><br></pre></td></tr></table></figure>

<p>注释掉 就OK了。</p>
<p>注意4: 如果想打印orm转换过程中的sql，需要在settings中进行如下配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;　　</span><br></pre></td></tr></table></figure>

<h3 id="5-8-3-添加表记录"><a href="#5-8-3-添加表记录" class="headerlink" title="5.8.3.添加表记录"></a>5.8.3.添加表记录</h3><h4 id="方式一：create"><a href="#方式一：create" class="headerlink" title="方式一：create"></a>方式一：create</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create方法的返回值book_obj，就是插入book表中的python葵花宝典这本书籍纪录对象</span></span><br><span class="line">  book_obj=Book.objects.create(title=<span class="string">&quot;python葵花宝典&quot;</span>,state=<span class="literal">True</span>,price=<span class="number">100</span>,publish=<span class="string">&quot;苹果出版社&quot;</span>,pub_date=<span class="string">&quot;2012-12-12&quot;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="方式二：-save"><a href="#方式二：-save" class="headerlink" title="方式二： save"></a>方式二： save</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book_obj=Book(title=<span class="string">&quot;python葵花宝典&quot;</span>,state=<span class="literal">True</span>,price=<span class="number">100</span>,publish=<span class="string">&quot;苹果出版社&quot;</span>,pub_date=<span class="string">&quot;2012-12-12&quot;</span>)</span><br><span class="line">book_obj.save()</span><br></pre></td></tr></table></figure>

<h3 id="5-8-4-查询表记录"><a href="#5-8-4-查询表记录" class="headerlink" title="5.8.4.查询表记录"></a>5.8.4.查询表记录</h3><h4 id="5-8-4-1-查询API"><a href="#5-8-4-1-查询API" class="headerlink" title="5.8.4.1.查询API"></a>5.8.4.1.查询API</h4><p>要清晰各个方法的返回值，以及方法的调用者</p>
<p>这样才能明白，什么情况下调用什么方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="number">1</span>&gt; <span class="built_in">all</span>():                  查询所有结果，返回一个QuerySet对象</span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">2</span>&gt; <span class="built_in">filter</span>(**kwargs):       它包含了与所给筛选条件相匹配的对象，相当于where语句</span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">3</span>&gt; get(**kwargs):          返回与所给筛选条件相匹配的对象，返回结果有且只有一个，</span><br><span class="line">                            如果符合筛选条件的对象超过一个或者没有都会抛出错误。返回一个model对象</span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">4</span>&gt; exclude(**kwargs):      它包含了与所给筛选条件不匹配的对象，返回一个QuerySet对象</span><br><span class="line"> </span><br><span class="line">&lt;<span class="number">5</span>&gt; order_by(*field):       对查询结果排序，默认升序，参数前加一个-，就是降序，调用者和返回值，都是一个QuerySet对象</span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">6</span>&gt; reverse():              对查询结果反向排序</span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">8</span>&gt; count():                返回数据库中匹配查询(QuerySet)的对象数量，调用者是QuerySet对象，返回值是<span class="built_in">int</span></span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">9</span>&gt; first():                返回第一条记录，调用者是QuerySet对象，返回一个model对象</span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">10</span>&gt; last():                返回最后一条记录，调用者是QuerySet对象，返回一个model对象</span><br><span class="line">  </span><br><span class="line">&lt;<span class="number">11</span>&gt; exists():              如果QuerySet包含数据，就返回<span class="literal">True</span>，否则返回<span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">&lt;<span class="number">12</span>&gt; values(*field):        返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不是一系列model的实例化对象，而是一个可迭代的字典序列</span><br><span class="line">    						调用者和返回值，都是一个QuerySet对象</span><br><span class="line">        					ret = Book.objects.<span class="built_in">all</span>().values(<span class="string">&quot;price&quot;</span>)</span><br><span class="line"></span><br><span class="line">&lt;<span class="number">13</span>&gt; values_list(*field):   它与values()非常相似，它返回的是一个元组序列，values返回的是一个字典序列</span><br><span class="line">    						ret = Book.objects.<span class="built_in">all</span>().values_list(<span class="string">&quot;price&quot;</span>,<span class="string">&quot;title&quot;</span>)</span><br><span class="line">        					</span><br><span class="line"> </span><br><span class="line">&lt;<span class="number">14</span>&gt; distinct():            从返回结果中剔除重复纪录</span><br><span class="line">    						reg = Book.objects.<span class="built_in">all</span>.values(<span class="string">&quot;price&quot;</span>).distinct()</span><br></pre></td></tr></table></figure>

<h4 id="5-8-4-2-基于双下划线的模糊查询"><a href="#5-8-4-2-基于双下划线的模糊查询" class="headerlink" title="5.8.4.2.基于双下划线的模糊查询"></a>5.8.4.2.基于双下划线的模糊查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Book.objects.<span class="built_in">filter</span>(price__in=[<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>])</span><br><span class="line">Book.objects.<span class="built_in">filter</span>(price__gt=<span class="number">100</span>) <span class="comment"># 大于</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(price__lt=<span class="number">100</span>) <span class="comment"># 小于</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(price__range=[<span class="number">100</span>,<span class="number">200</span>])</span><br><span class="line">Book.objects.<span class="built_in">filter</span>(title__contains=<span class="string">&quot;python&quot;</span>) <span class="comment"># 包含某个字符</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(title__icontains=<span class="string">&quot;python&quot;</span>) <span class="comment"># 包含某个字符，不区分大小写</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(title__startswith=<span class="string">&quot;py&quot;</span>) <span class="comment"># 以某个字符串开头</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(pub_date__year=<span class="number">2012</span>) <span class="comment">#只有date类型，才能这样写</span></span><br></pre></td></tr></table></figure>



<h3 id="5-8-5删除表纪录"><a href="#5-8-5删除表纪录" class="headerlink" title="5.8.5删除表纪录"></a>5.8.5删除表纪录</h3><p>删除方法就是 delete()。它运行时立即删除对象而不返回任何值。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model_obj.delete()</span><br></pre></td></tr></table></figure>

<p>你也可以一次性删除多个对象。每个 QuerySet 都有一个 delete() 方法，它一次性删除 QuerySet 中所有的对象。</p>
<p>例如，下面的代码将删除 pub_date 是2005年的 Entry 对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.<span class="built_in">filter</span>(pub_date__year=<span class="number">2005</span>).delete()</span><br></pre></td></tr></table></figure>

<p>在 Django 删除对象时，会模仿 SQL 约束 ON DELETE CASCADE 的行为，换句话说，删除一个对象时也会删除与它相关联的外键对象。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b = Blog.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># This will delete the Blog and all of its Entry objects.</span></span><br><span class="line">b.delete()</span><br></pre></td></tr></table></figure>

<p>要注意的是： delete() 方法是 QuerySet 上的方法，但并不适用于 Manager 本身。这是一种保护机制，是为了避免意外地调用 Entry.objects.delete() 方法导致 所有的 记录被误删除。如果你确认要删除所有的对象，那么你必须显式地调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.<span class="built_in">all</span>().delete()　　</span><br></pre></td></tr></table></figure>

<p>如果不想级联删除，可以设置为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pubHouse = models.ForeignKey(to=<span class="string">&#x27;Publisher&#x27;</span>, on_delete=models.SET_NULL, blank=<span class="literal">True</span>, null=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="5-8-6-修改表纪录"><a href="#5-8-6-修改表纪录" class="headerlink" title="5.8.6.修改表纪录"></a>5.8.6.修改表纪录</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Book.objects.<span class="built_in">filter</span>(title__startswith=<span class="string">&quot;py&quot;</span>).update(price=<span class="number">120</span>)</span><br></pre></td></tr></table></figure>

<p>此外，update()方法对于任何结果集（QuerySet）均有效，这意味着你可以同时更新多条记录，update()方法会返回一个整型数值，表示受影响的记录条数。　</p>
<h3 id="5-8-7-图书管理系统小练习"><a href="#5-8-7-图书管理系统小练习" class="headerlink" title="5.8.7.图书管理系统小练习"></a>5.8.7.图书管理系统小练习</h3><p>图书管理系统</p>
<p><img src="https://img-blog.csdnimg.cn/bb1cad80838f43a9bd957c90e3427b27.png" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/1200a9866b5448afa9f8b3d0db6076f5.png" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 查询人民出版社出版过的价格大于200的书籍</span><br><span class="line"> </span><br><span class="line">2 查询2017年8月出版的所有以py开头的书籍名称</span><br><span class="line"> </span><br><span class="line">3 查询价格为50,100或者150的所有书籍名称及其出版社名称</span><br><span class="line"> </span><br><span class="line">4 查询价格在100到200之间的所有书籍名称及其价格</span><br><span class="line"> </span><br><span class="line">5 查询所有人民出版社出版的书籍的价格（从高到低排序，去重）</span><br></pre></td></tr></table></figure>

<h4 id="5-8-7-1-添加页面"><a href="#5-8-7-1-添加页面" class="headerlink" title="5.8.7.1.添加页面"></a>5.8.7.1.添加页面</h4><h4 id="5-8-7-2-查看书籍"><a href="#5-8-7-2-查看书籍" class="headerlink" title="5.8.7.2.查看书籍"></a>5.8.7.2.查看书籍</h4><h4 id="5-8-7-3-查看书籍"><a href="#5-8-7-3-查看书籍" class="headerlink" title="5.8.7.3.查看书籍"></a>5.8.7.3.查看书籍</h4><h4 id="5-8-7-4-删除书籍"><a href="#5-8-7-4-删除书籍" class="headerlink" title="5.8.7.4.删除书籍"></a>5.8.7.4.删除书籍</h4><h4 id="5-8-7-5-编辑功能"><a href="#5-8-7-5-编辑功能" class="headerlink" title="5.8.7.5.编辑功能"></a>5.8.7.5.编辑功能</h4><p>删除</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Saiable">Sai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mindcons.cn/2023/11/13/md/python/django/django_%E5%9F%BA%E7%A1%80/">https://mindcons.cn/2023/11/13/md/python/django/django_基础/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mindcons.cn" target="_blank">吕小布の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://bu.dusays.com/2023/02/10/63e580229ee01.webp" target="_blank"><img class="post-qr-code-img" src="https://bu.dusays.com/2023/02/10/63e580229ee01.webp" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://bu.dusays.com/2023/02/09/63e48775d4f42.webp" target="_blank"><img class="post-qr-code-img" src="https://bu.dusays.com/2023/02/09/63e48775d4f42.webp" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/13/md/python/django/django%E5%9F%BA%E7%A1%80+%E5%AE%9E%E6%88%98_%E6%80%BB%E8%A7%88/"><img class="prev-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/2023/11/13/md/network/nginx/nginx%E5%9F%BA%E7%A1%80/"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://bu.dusays.com/2023/02/10/63e583843360e.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Sai</div><div class="author-info__description">天可补,海可填,南山可移。日月既往,不可复追。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">178</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Saiable"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://bu.dusays.com/2023/02/10/63e57e822f198.webp" target="_blank" title="QQ"><i class="fa-brands fa-qq"></i></a><a class="social-icon" href="https://bu.dusays.com/2023/02/10/63e57f8ac9fae.webp" target="_blank" title="WeChat"><i class="fa-brands fa-weixin"></i></a><a class="social-icon" href="https://github.com/Saiable" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:mindcons@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">日月既往,不可复追。</div></div><div class="xpand" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/twopeople1.js"></script><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/zdog.dist.js"></script><script id="rendered-js" src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/twopeople.js"></script><style>.card-widget.card-announcement {
margin: 0;
align-items: center;
justify-content: center;
text-align: center;
}
canvas {
display: block;
margin: 0 auto;
cursor: move;
}</style><div class="card-widget tzy-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face"></div><div class="back face"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.</span> <span class="toc-text">1.web应用程序</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.1.</span> <span class="toc-text">1.1.实现简单的web应用程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%AF%B9%E6%AF%94TCP%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.2.</span> <span class="toc-text">1.2.对比TCP连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E6%96%B0%E5%A2%9Eweb%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.</span> <span class="toc-text">1.3.新增web应用程序的功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-%E5%8A%A0%E7%B2%97%E6%A0%87%E9%A2%98"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1.加粗标题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-%E5%8A%A0%E4%B8%8A%E5%9B%BE%E7%89%87"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2.加上图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E5%B0%81%E8%A3%85%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3.封装前端代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Http%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.</span> <span class="toc-text">2.Http协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E8%AF%B7%E6%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.</span> <span class="toc-text">2.1.请求协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-get%E8%AF%B7%E6%B1%82"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1.get请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-post%E8%AF%B7%E6%B1%82"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2.post请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%93%8D%E5%BA%94%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2.2.响应协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E6%9E%84%E6%88%90"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1.响应报文构成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.1响应状态码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-wsgiref%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">3.wsgiref模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-web%E6%A1%86%E6%9E%B6"><span class="toc-number">3.1.</span> <span class="toc-text">3.1.web框架</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-DIY%E4%B8%80%E4%B8%AAweb%E6%A1%86%E6%9E%B6"><span class="toc-number">4.</span> <span class="toc-text">4.DIY一个web框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%96%B9%E6%A1%88%E4%B8%80"><span class="toc-number">4.1.</span> <span class="toc-text">4.1.方案一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%96%B9%E6%A1%88%E4%BA%8C"><span class="toc-number">4.2.</span> <span class="toc-text">4.2.方案二</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E8%A7%A3%E8%80%A6"><span class="toc-number">4.3.</span> <span class="toc-text">4.3.解耦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E4%BB%80%E4%B9%88%E6%98%AF%E6%A1%86%E6%9E%B6"><span class="toc-number">4.4.</span> <span class="toc-text">4.4.什么是框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E5%85%B3%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%89"><span class="toc-number">4.5.</span> <span class="toc-text">4.5.关于数据库的操作（核心）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-web-%E6%A1%86%E6%9E%B6%E5%8A%9F%E8%83%BD%E6%80%BB%E7%BB%93"><span class="toc-number">4.6.</span> <span class="toc-text">4.6.web 框架功能总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Django%E7%AE%80%E4%BB%8B"><span class="toc-number">5.</span> <span class="toc-text">5.Django简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-MVC%E4%B8%8EMTV%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">5.1.MVC与MTV模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-Django%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.</span> <span class="toc-text">5.2.Django下载与基本命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Django%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.3.</span> <span class="toc-text">5.3.Django简单示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.</span> <span class="toc-text">5.4.静态文件配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-1-static%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.1.</span> <span class="toc-text">5.4.1.static配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E8%B7%AF%E7%94%B1%E6%8E%A7%E5%88%B6"><span class="toc-number">5.5.</span> <span class="toc-text">5.5.路由控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-1-%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.1.</span> <span class="toc-text">5.5.1.简单配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-2-%E6%9C%89%E5%90%8D%E5%88%86%E7%BB%84"><span class="toc-number">5.5.2.</span> <span class="toc-text">5.5.2.有名分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-3-%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91"><span class="toc-number">5.5.3.</span> <span class="toc-text">5.5.3.路由分发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-4-%E7%99%BB%E9%99%86%E9%AA%8C%E8%AF%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.5.4.</span> <span class="toc-text">5.5.4.登陆验证示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-5-%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-number">5.5.5.</span> <span class="toc-text">5.5.5.反向解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-6-%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4"><span class="toc-number">5.5.6.</span> <span class="toc-text">5.5.6.名称空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-7-path%E6%96%B9%E6%B3%95"><span class="toc-number">5.5.7.</span> <span class="toc-text">5.5.7.path方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-7-1-%E5%86%85%E7%BD%AE%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">5.5.7.1.</span> <span class="toc-text">5.5.7.1.内置转换器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-7-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">5.5.7.2.</span> <span class="toc-text">5.5.7.2.自定义转换器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-%E8%A7%86%E5%9B%BE"><span class="toc-number">5.6.</span> <span class="toc-text">5.6.视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-1-%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.6.1.</span> <span class="toc-text">5.6.1.请求对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-1-1-request%E5%B1%9E%E6%80%A7"><span class="toc-number">5.6.1.1.</span> <span class="toc-text">5.6.1.1.request属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-1-2-request%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">5.6.1.2.</span> <span class="toc-text">5.6.1.2.request常用方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-2-%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.6.2.</span> <span class="toc-text">5.6.2.响应对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-2-1-render"><span class="toc-number">5.6.2.1.</span> <span class="toc-text">5.6.2.1.render()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-2-2-redirect"><span class="toc-number">5.6.2.2.</span> <span class="toc-text">5.6.2.2.redirect()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95"><span class="toc-number">5.7.</span> <span class="toc-text">5.7.模板语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-1-%E5%8F%98%E9%87%8F"><span class="toc-number">5.7.1.</span> <span class="toc-text">5.7.1.变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-2-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">5.7.2.</span> <span class="toc-text">5.7.2.过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-3-%E6%A0%87%E7%AD%BE"><span class="toc-number">5.7.3.</span> <span class="toc-text">5.7.3.标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE%E5%92%8C%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">5.7.4.</span> <span class="toc-text">5.7.4.自定义标签和过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-5-%E7%BB%A7%E6%89%BF"><span class="toc-number">5.7.5.</span> <span class="toc-text">5.7.5.继承</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-8-ORM"><span class="toc-number">5.8.</span> <span class="toc-text">5.8.ORM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-1-ORM%E7%AE%80%E4%BB%8B"><span class="toc-number">5.8.1.</span> <span class="toc-text">5.8.1.ORM简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-2-%E5%8D%95%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">5.8.2.</span> <span class="toc-text">5.8.2.单表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-2-1-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">5.8.2.1.</span> <span class="toc-text">5.8.2.1.创建表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.8.2.1.1.</span> <span class="toc-text">1.创建模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9B%B4%E5%A4%9A%E5%AD%97%E6%AE%B5%E5%92%8C%E5%8F%82%E6%95%B0"><span class="toc-number">5.8.2.1.2.</span> <span class="toc-text">2 更多字段和参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-settings%E9%85%8D%E7%BD%AE"><span class="toc-number">5.8.2.1.3.</span> <span class="toc-text">3 settings配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-3-%E6%B7%BB%E5%8A%A0%E8%A1%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">5.8.3.</span> <span class="toc-text">5.8.3.添加表记录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9Acreate"><span class="toc-number">5.8.3.1.</span> <span class="toc-text">方式一：create</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A-save"><span class="toc-number">5.8.3.2.</span> <span class="toc-text">方式二： save</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-4-%E6%9F%A5%E8%AF%A2%E8%A1%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">5.8.4.</span> <span class="toc-text">5.8.4.查询表记录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-4-1-%E6%9F%A5%E8%AF%A2API"><span class="toc-number">5.8.4.1.</span> <span class="toc-text">5.8.4.1.查询API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-4-2-%E5%9F%BA%E4%BA%8E%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E7%9A%84%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.8.4.2.</span> <span class="toc-text">5.8.4.2.基于双下划线的模糊查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-5%E5%88%A0%E9%99%A4%E8%A1%A8%E7%BA%AA%E5%BD%95"><span class="toc-number">5.8.5.</span> <span class="toc-text">5.8.5删除表纪录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-6-%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BA%AA%E5%BD%95"><span class="toc-number">5.8.6.</span> <span class="toc-text">5.8.6.修改表纪录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-7-%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%B0%8F%E7%BB%83%E4%B9%A0"><span class="toc-number">5.8.7.</span> <span class="toc-text">5.8.7.图书管理系统小练习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-7-1-%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.8.7.1.</span> <span class="toc-text">5.8.7.1.添加页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-7-2-%E6%9F%A5%E7%9C%8B%E4%B9%A6%E7%B1%8D"><span class="toc-number">5.8.7.2.</span> <span class="toc-text">5.8.7.2.查看书籍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-7-3-%E6%9F%A5%E7%9C%8B%E4%B9%A6%E7%B1%8D"><span class="toc-number">5.8.7.3.</span> <span class="toc-text">5.8.7.3.查看书籍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-7-4-%E5%88%A0%E9%99%A4%E4%B9%A6%E7%B1%8D"><span class="toc-number">5.8.7.4.</span> <span class="toc-text">5.8.7.4.删除书籍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-7-5-%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-number">5.8.7.5.</span> <span class="toc-text">5.8.7.5.编辑功能</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/12/06/md/data/%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B8%8E%E8%BF%9B%E9%98%B6/" title="无题"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2023/12/06/md/data/%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E4%B8%8E%E5%88%86%E6%9E%90/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B8%8E%E8%BF%9B%E9%98%B6/" title="无题">无题</a><time datetime="2023-12-05T23:08:14.736Z" title="发表于 2023-12-06 07:08:14">2023-12-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/01/md/data/%E6%95%B0%E6%8D%AE%E6%A0%87%E6%B3%A8/ppocrlabel/" title="ppocrlabel安装及使用">ppocrlabel安装及使用</a><time datetime="2023-11-30T22:12:44.754Z" title="发表于 2023-12-01 06:12:44">2023-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/01/md/data/%E6%95%B0%E6%8D%AE%E6%A0%87%E6%B3%A8/labelStudio%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" title="labelStudio安装及使用">labelStudio安装及使用</a><time datetime="2023-11-30T22:12:44.739Z" title="发表于 2023-12-01 06:12:44">2023-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/01/md/data/%E6%95%B0%E6%8D%AE%E6%A0%87%E6%B3%A8/brat%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/" title="brat安装步骤及注意事项">brat安装步骤及注意事项</a><time datetime="2023-11-30T22:12:44.726Z" title="发表于 2023-12-01 06:12:44">2023-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/13/md/linux/%E8%BF%90%E7%BB%B4/Neovim/neovim%E5%AE%9E%E6%93%8D/" title="Neovim 实操">Neovim 实操</a><time datetime="2023-11-12T23:58:07.758Z" title="发表于 2023-11-13 07:58:07">2023-11-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://bu.dusays.com/2023/02/10/63e57cef87293.webp')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 <i id="heartbeat" class="fa fas fa-heartbeat"></i> Sai</div><a href="https://icp.gov.moe/?keyword=20230203" target="_blank">萌ICP备20230203号</a><div class="footer_custom_text"><p><a target="_blank" href="https://hexo.io/"><img src="https://bu.dusays.com/2023/02/09/63e488a78b827.webp" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://bu.dusays.com/2023/02/10/63e57f321880a.webp" title="主题采用butterfly"></a></p></div></div><link rel="stylesheet" href="/custom/css/heartbeat.min.css" ></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuNormal"><div class="rightMenu-item" id="menu-translate"><i class="fa-solid fa-earth-asia"></i><span>繁简切换</span></div><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-moon"></i><span>切换模式</span></div><div class="rightMenu-item" id="menu-print"><i class="fa-solid fa-print fa-fw"></i><span>打印页面</span></div></div></div><div id="rightmenu-mask"></div><div id="myscoll"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.mindcons.cn/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.mindcons.cn/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/custom/js/universe.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/custom/js/rightMenu.js"></script><script defer data-pjax src="/custom/js/cat.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "717070d8-e449-4d60-b9b6-c1421478f42c";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (true) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>